language: android
env:
    - BUILD_TYPE=android
android:
    components:
        - platform-tools
        - tools
        - build-tools-23.0.1
        - android-23
        - appcompat-v7
        - extra-android-support
        - extra-android-m2repository

        # Specify at least one system image,
        # if you need to run emulator(s) during your tests
        - sys-img-armeabi-v7a-android-23
        - sys-img-x86-android-23

before_cache:
      - rm -f $HOME/.gradle/caches/modules-2/modules-2.lock
cache:
    directories:
        - $HOME/.gradle/caches/
        - $HOME/.gradle/wrapper/
before_install:
    - git clone https://github.com/creationix/nvm.git /tmp/.nvm
    - source /tmp/.nvm/nvm.sh
    - nvm install 6.0
    - nvm use --delete-prefix 6.0
    - node --version && npm --version

install:
    - source build-scripts/bootstrap.sh
script:
    - npm test
    - env
    - source ./build-scripts/build.sh

after_script:
      # Emulator Management: Create, Start and Wait
    - echo no | android create avd --force -n test -t android-19 --abi armeabi-v7a
    - emulator -avd test -no-skin -no-audio -no-window &
    - android-wait-for-emulator
    - adb shell input keyevent 82 &
    - source ./test-scripts/test.sh

after_success:
    - source ./build-scripts/deploy.sh